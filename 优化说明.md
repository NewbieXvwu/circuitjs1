# CircuitJS1 优化说明

## 完成的任务

### 1. ✅ 优化Tauri版APP启动速度，解决白屏问题

**问题描述：**
Tauri版本的应用在启动时会显示一段时间的白屏，用户体验不佳。

**解决方案：**
实现了优雅的启动加载流程，使用loading动画替代白屏。

**技术实现：**

1. **窗口初始隐藏** (`src-tauri/tauri.conf.json`)
   - 将窗口的 `visible` 属性设置为 `false`
   - 窗口在启动时不会立即显示

2. **添加loading界面** (`prepare-tauri.sh`)
   - 在HTML中注入漂亮的loading动画
   - 紫色渐变背景 + 旋转的loading指示器
   - 显示 "Loading CircuitJS1..." 文字提示

3. **智能显示窗口** (`src-tauri/src/main.rs`)
   - 新增 `show_main_window` 命令
   - JavaScript监听页面加载完成事件
   - 自动调用Rust后端显示窗口
   - Loading动画平滑淡出（0.3秒过渡）

**效果：**
- ✨ 启动时显示专业的loading动画，不再白屏
- ✨ 内容加载完成后平滑过渡到主界面
- ✨ 提升用户体验和应用专业度

### 2. ✅ 为Tauri和Electron添加免安装版本（Portable）

**需求：**
用户希望有免安装版本，可以直接解压使用，无需安装。

#### Tauri版本实现

**修改文件：**
- `.github/workflows/build-tauri-windows.yml`

**实现内容：**
- 添加了 "Create portable version" 构建步骤
- 自动打包可执行文件为ZIP格式
- 包含README说明文件
- 输出文件：`CircuitJS1-Tauri-Windows-x64-Portable.zip`

**产物包含：**
1. MSI安装包（原有）
2. NSIS安装程序（原有）
3. **免安装ZIP包**（新增）

#### Electron版本实现

**修改文件：**
- `app/package.json` - 添加portable构建目标
- `.github/workflows/build-electron-windows.yml` - 调整artifact名称

**实现内容：**
- 在electron-builder配置中添加 `portable` 目标
- 自动生成便携版可执行文件

**产物包含：**
1. NSIS安装程序（原有）
2. **便携版EXE**（新增）

## 使用说明

### 本地构建Tauri应用

```bash
# 1. 编译GWT项目
./gradlew compileGwt makeSite

# 2. 准备Tauri（会自动注入loading界面）
./prepare-tauri.sh

# 3. 构建Tauri应用
cd src-tauri
cargo tauri build
```

### 本地构建Electron应用

```bash
# 1. 编译GWT项目
./gradlew compileGwt makeSite

# 2. 准备Electron
cd app
rm -rf war
cp -r ../site war

# 3. 安装依赖并构建（会生成安装版和便携版）
npm install
npm run build:win
```

### GitHub Actions自动构建

1. 进入GitHub仓库的Actions页面
2. 选择对应的workflow：
   - **Tauri**: "Build Tauri Windows x64"
   - **Electron**: "Build Electron Windows x64"
3. 点击 "Run workflow" 触发构建
4. 构建完成后，在Artifacts中下载：
   - Tauri：MSI、NSIS安装程序、免安装ZIP包
   - Electron：NSIS安装程序、便携版EXE

## 便携版优势

✅ **无需安装**
- 解压即用，无需运行安装程序

✅ **无需管理员权限**
- 不修改系统注册表
- 不需要提升权限

✅ **便于携带**
- 可放入U盘随身携带
- 适合在不同电脑间使用

✅ **独立运行**
- 每个实例相互独立
- 便于测试多个版本

✅ **快速部署**
- 适合企业批量部署
- 适合教育环境使用
- 无需IT部门安装

## 修改的文件列表

### Tauri优化相关
- ✏️ `src-tauri/tauri.conf.json` - 窗口初始隐藏配置
- ✏️ `src-tauri/src/main.rs` - 添加显示窗口命令
- ✏️ `prepare-tauri.sh` - 注入loading界面和显示逻辑

### Tauri便携版相关
- ✏️ `.github/workflows/build-tauri-windows.yml` - 添加便携版打包步骤

### Electron便携版相关
- ✏️ `app/package.json` - 添加portable构建目标
- ✏️ `.github/workflows/build-electron-windows.yml` - 调整artifact名称

## 兼容性说明

✅ **向后兼容**
- 所有更改不影响现有功能
- 安装版本保持不变
- 用户可自由选择安装版或便携版

✅ **跨平台兼容**
- Loading优化只在Tauri版本生效
- Electron版本保持原有行为
- 两个版本互不干扰

## 技术亮点

🎨 **优雅的用户体验**
- 现代化的loading动画设计
- 平滑的过渡效果
- 专业的视觉呈现

🔧 **灵活的部署选项**
- 支持传统安装方式
- 支持便携式部署
- 满足不同场景需求

⚡ **优化的启动流程**
- 智能检测加载状态
- 避免白屏闪烁
- 提升启动速度感知

## 后续建议

如果需要进一步优化，可以考虑：

1. **预加载关键资源**
   - 在loading期间预加载常用电路组件
   - 提前初始化核心模块

2. **自定义loading动画**
   - 添加品牌元素
   - 显示加载进度百分比
   - 添加提示文字（如"正在加载电路库..."）

3. **启动参数优化**
   - 支持命令行参数快速打开文件
   - 记住上次窗口位置和大小

4. **便携版增强**
   - 添加自定义配置文件支持
   - 支持相对路径的电路库
   - 便携数据存储选项
